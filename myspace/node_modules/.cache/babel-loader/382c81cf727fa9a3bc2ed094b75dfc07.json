{"ast":null,"code":"import $ from 'jquery';\nimport jwt_decode from 'jwt-decode';\nconst ModuleUser = {\n  state: {\n    id: \"\",\n    username: \"\",\n    photo: \"\",\n    followerCount: 0,\n    access: \"\",\n    //令牌\n    refresh: \"\",\n    //刷新令牌\n    is_login: false //是否登录\n\n  },\n  getters: {},\n  mutations: {\n    updateUser(state, user) {\n      state.id = user.id; //忘写.id导致的wa\n\n      state.username = user.username;\n      state.photo = user.photo;\n      state.followerCount = user.followerCount;\n      state.access = user.access;\n      state.refresh = user.fresh;\n      state.is_login = user.is_login;\n    },\n\n    //actions不能直接修改state\n    updateAccess(state, access) {\n      state.access = access;\n    },\n\n    logout(state) {\n      state.id = \"\";\n      state.username = \"\";\n      state.photo = \"\";\n      state.followerCount = 0;\n      state.access = \"\";\n      state.refresh = \"\";\n      state.is_login = false;\n    }\n\n  },\n  actions: {\n    //一开始放错了位置\n    //登录\n    login(context, data) {\n      $.ajax({\n        url: \"https://app165.acapp.acwing.com.cn/api/token/\",\n        type: \"POST\",\n        //写成post，没加引号\n        data: {\n          username: data.username,\n          password: data.password\n        },\n\n        success(resp) {\n          //console.log(resp);\n          //获取refresh和access\n          const {\n            access,\n            refresh\n          } = resp; //获取用户名\n          //jwt验证\n\n          const access_obj = jwt_decode(access); //解码\n          //console.log(access_obj,refresh);//refresh也要输出\n          //定期刷新更新access令牌\n\n          setInterval(() => {\n            $.ajax({\n              url: \"https://app165.acapp.acwing.com.cn/api/token/refresh/\",\n              type: \"POST\",\n              data: {\n                refresh\n              },\n\n              success(resp) {\n                //console.log(resp);\n                //console.log(\"refresh started\");\n                context.commit('updateAccess', resp.access);\n              }\n\n            });\n          }, 4.5 * 60 * 1000);\n          $.ajax({\n            url: \"https://app165.acapp.acwing.com.cn/myspace/getinfo/\",\n            type: \"GET\",\n            data: {\n              user_id: access_obj.user_id\n            },\n            headers: {\n              'Authorization': \"Bearer \" + access //注意空格\n\n            },\n\n            success(resp) {\n              //console.log(resp);\n              context.commit(\"updateUser\", { ...resp,\n                access: access,\n                refresh: refresh,\n                is_login: true\n              }); //调用回调函数\n\n              data.success();\n            }\n\n          });\n        },\n\n        error() {\n          data.error();\n        }\n\n      });\n    }\n\n  },\n  modules: {}\n};\nexport default ModuleUser;","map":{"version":3,"names":["$","jwt_decode","ModuleUser","state","id","username","photo","followerCount","access","refresh","is_login","getters","mutations","updateUser","user","fresh","updateAccess","logout","actions","login","context","data","ajax","url","type","password","success","resp","access_obj","setInterval","commit","user_id","headers","error","modules"],"sources":["C:/Users/DELL/Desktop/chess/myspace/src/store/user.js"],"sourcesContent":["import $ from 'jquery'\r\nimport jwt_decode from 'jwt-decode'\r\n\r\nconst ModuleUser={\r\n    state:{\r\n        id:\"\",\r\n        username:\"\",\r\n        photo:\"\",\r\n        followerCount:0,\r\n        access:\"\",//令牌\r\n        refresh:\"\",//刷新令牌\r\n        is_login:false,//是否登录\r\n\r\n    },\r\n    getters:{\r\n\r\n    },\r\n    mutations:{\r\n        updateUser(state,user){\r\n            state.id=user.id;//忘写.id导致的wa\r\n            state.username=user.username;\r\n            state.photo=user.photo;\r\n            state.followerCount=user.followerCount;\r\n            state.access=user.access;\r\n            state.refresh=user.fresh;\r\n            state.is_login=user.is_login;\r\n        },\r\n        //actions不能直接修改state\r\n        updateAccess(state,access){\r\n            state.access=access;\r\n\r\n        },\r\n        logout(state){\r\n            state.id=\"\";\r\n            state.username=\"\";\r\n            state.photo=\"\";\r\n            state.followerCount=0;\r\n            state.access=\"\";\r\n            state.refresh=\"\";\r\n            state.is_login=false;\r\n\r\n\r\n        }\r\n\r\n    },\r\n    actions:{\r\n        //一开始放错了位置\r\n          //登录\r\n    login(context,data){\r\n        $.ajax({\r\n          url:\"https://app165.acapp.acwing.com.cn/api/token/\",\r\n          type:\"POST\",//写成post，没加引号\r\n          data:{\r\n            username:data.username,\r\n            password:data.password,\r\n          \r\n          },\r\n          success(resp){\r\n            //console.log(resp);\r\n            //获取refresh和access\r\n            const {access,refresh}=resp;\r\n            //获取用户名\r\n            //jwt验证\r\n            const access_obj=jwt_decode(access);//解码\r\n            //console.log(access_obj,refresh);//refresh也要输出\r\n            //定期刷新更新access令牌\r\n            setInterval(()=>{\r\n                $.ajax({\r\n                    url:\"https://app165.acapp.acwing.com.cn/api/token/refresh/\",\r\n                    type:\"POST\",\r\n                    data:{\r\n                        refresh,\r\n                    },\r\n                    success(resp){\r\n                        //console.log(resp);\r\n                        //console.log(\"refresh started\");\r\n                        context.commit('updateAccess',resp.access);\r\n                    }\r\n\r\n                });\r\n\r\n            },4.5*60*1000);\r\n            $.ajax({\r\n                url:\"https://app165.acapp.acwing.com.cn/myspace/getinfo/\",\r\n                type:\"GET\",\r\n                data:{\r\n                    user_id:access_obj.user_id,\r\n\r\n                },\r\n                headers:{\r\n                    'Authorization':\"Bearer \" +access, //注意空格\r\n                },\r\n                success(resp){\r\n                    //console.log(resp);\r\n                    context.commit(\"updateUser\",{\r\n                        ...resp,\r\n                        access:access,\r\n                        refresh:refresh,\r\n                        is_login:true,\r\n                    });\r\n                    //调用回调函数\r\n                    data.success();\r\n\r\n                },\r\n               \r\n            })\r\n          },\r\n          error(){\r\n            data.error();\r\n\r\n\r\n        }\r\n        });\r\n  \r\n      },\r\n    \r\n\r\n    },\r\n    modules:{\r\n         \r\n\r\n    }\r\n\r\n};\r\nexport default ModuleUser;"],"mappings":"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"},"metadata":{},"sourceType":"module"}